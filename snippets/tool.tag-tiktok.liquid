{% comment %}theme-check-disable RemoteAsset,ImgLazyLoading{% endcomment %}
{%- if shop.metafields.settings.tags.tiktok.enable and shop.metafields.settings.tags.tiktok.tag_id != blank -%}
  <script>
    !function (w, d, t) {
      w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++
  )ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var i="https://analytics.tiktok.com/i18n/pixel/events.js";ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=i,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=i+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};
    
      ttq.load('{{ shop.metafields.settings.tags.tiktok.tag_id }}');
      ttq.page();
    }(window, document, 'ttq');

    {%- if customer -%}
      ttq.identify({
        sha256_email: '{{ customer.email | downcase | sha256 }}',
        {% if customer.phone -%}
        sha256_phone_number: '{{ customer.phone | sha256 }}'
        {% endif -%}
      });
    {%- endif -%}

    ttq.enableCookie();
  </script>
  {%- liquid
    if uses_comma_decimals
      assign product_price = product.selected_or_first_available_variant.price | money_without_currency | replace: '.', '' | replace: ',', '.' | times: 1 | json
    else
      assign product_price = product.selected_or_first_available_variant.price | money_without_currency | replace: ',', '' | times: 1 | json
    endif
  -%}

  {%- case template.name -%}
    {%- when 'product' -%}
      <script>
        ttq.track('ViewContent', {
          content_id: 'shopify_{{ shop.metafields.settings.main.shop_country }}_{{ product.id }}_{{ product.selected_or_first_available_variant.id }}',
          content_type: 'product',
          content_name: '{{ product.title }}',
          content_category: '{{ product.type | split: ' - ' | last }}',
          price: {{ product_price }},
          value: {{ product_price }},
          currency: '{{ cart.currency.iso_code }}'
        });
      </script>
    
    {%- when 'search' -%}
      {%- if search.performed -%}
        <script>
          ttq.track('Search', {
            query: '{{ search.terms }}'
          });
        </script>
      {%- else -%}
        <script>
          ttq.track('ViewContent');
        </script>
      {%- endif -%}
    
    {%- else -%}
      <script>
        ttq.track('ViewContent');
      </script>
  {%- endcase -%}

{%- endif -%}
